<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard - Atracker Institute</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
body {
  margin:0;
  font-family:'Roboto', sans-serif;
  background: linear-gradient(135deg, #0a1f44, #1e3c72);
  background-size:400% 400%;
  animation: gradientBG 15s ease infinite;
  overflow-x:hidden;
}
@keyframes gradientBG{
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}

/* Sidebar */
.sidebar {
  position: fixed;
  top:60px;
  left:-250px;
  width:250px;
  height:100%;
  background: rgba(255,255,255,0.15);
  backdrop-filter: blur(15px);
  border-right:1px solid rgba(255,255,255,0.3);
  box-shadow: 2px 0 20px rgba(0,0,0,0.4);
  transition: left 0.7s ease;
  padding-top: 20px;
  z-index: 999;
}
.sidebar.active { left:0; }
.sidebar h3 {
  color:#fff;
  text-align:center;
  margin-bottom:2rem;
  text-shadow:0 0 5px rgba(0,0,0,0.3);
}
.sidebar ul { list-style:none; padding:0; }
.sidebar ul li {
  padding: 1rem 1.5rem;
  color:#fff;
  font-weight:500;
  cursor:pointer;
  display:flex;
  align-items:center;
  opacity:0;
  transform: translateX(-20px);
  transition: all 0.5s ease;
}
.sidebar.active ul li {
  opacity:1;
  transform: translateX(0);
}
.sidebar.active ul li:nth-child(1){ transition-delay: 0.05s; }
.sidebar.active ul li:nth-child(2){ transition-delay: 0.10s; }
.sidebar.active ul li:nth-child(3){ transition-delay: 0.15s; }
.sidebar.active ul li:nth-child(4){ transition-delay: 0.20s; }
.sidebar.active ul li:nth-child(5){ transition-delay: 0.25s; }
.sidebar ul li:hover {
  background: rgba(255,255,255,0.25);
  border-radius:8px;
  transform: translateX(5px);
}
.sidebar ul li .material-icons { margin-right:1rem; transition: color 0.3s ease; }
.sidebar ul li:hover .material-icons { color:#ffd700; }

/* Topbar */
.topbar {
  position: fixed;
  top:0;
  left:0;
  width:100%;
  height:60px;
  background: rgba(255,255,255,0.15);
  backdrop-filter: blur(15px);
  border-bottom:1px solid rgba(255,255,255,0.3);
  display:flex;
  justify-content: space-between;
  align-items: center;
  padding:0 1rem;
  box-sizing:border-box;
  z-index: 1000;
}
.topbar h2 {
  color:#fff;
  text-shadow:0 0 5px rgba(0,0,0,0.3);
  margin:0;
  font-size:1.4rem;
  text-align:center;
  flex:1;
}
.menu-btn {
  font-size:2rem;
  color:#fff;
  cursor:pointer;
  transition:0.3s;
  z-index: 1001;
}
.menu-btn:hover { color:#ffd700; }

.logout-btn {
  padding:0.5rem 1rem;
  background:#ffd700;
  color:#1e3c72;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:500;
  transition:0.3s;
}
.logout-btn:hover { background:#e6c200; }

/* Main content */
.main {
  margin-top:60px;
  margin-left:0;
  padding:2rem;
  transition: margin-left 0.7s ease;
  color:#fff;
}
.sidebar.active ~ .main { margin-left:250px; }

/* Cards */
.cards {
  display:grid;
  grid-template-columns: repeat(auto-fit,minmax(200px,1fr));
  gap:1.5rem;
}
.card {
  background: rgba(255,255,255,0.15);
  backdrop-filter: blur(15px);
  padding:2rem;
  border-radius:15px;
  box-shadow:0 10px 30px rgba(0,0,0,0.3);
  text-align:center;
  transition: all 0.3s ease;
  cursor:pointer;
}
.card:hover { transform: scale(1.05) translateY(-5px); box-shadow:0 15px 35px rgba(0,0,0,0.5); }
.card .material-icons { font-size:3rem; margin-bottom:1rem; color:#ffd700; }

/* Fade in cards */
.card { opacity:0; transform: translateY(20px); transition: all 0.6s ease; }
.card.visible { opacity:1; transform: translateY(0); }

/* Teacher Manager Form/Table Styling */
.teacher-section {
  max-width: 900px;       
  margin: 2rem auto;      
  background: rgba(255,255,255,0.15);
  backdrop-filter: blur(15px);
  padding: 20px;
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  color: #fff;
}

.teacher-section h3 {
  margin-top: 0;
  text-align: center;
  text-shadow: 0 0 5px rgba(0,0,0,0.3);
}

.teacher-section input, .teacher-section button {
  width: 100%;
  padding: 10px;
  margin: 8px 0;
  border-radius: 8px;
  border: none;
  outline: none;
  box-sizing: border-box;
}

.teacher-section button {
  background: #ffd700;
  color: #1e3c72;
  font-weight: 300;
  cursor: pointer;
  transition: 0.3s;
}

.teacher-section button:hover { background: #e6c200; }

/* Table styling */
.teacher-section table {
  width: 150%;
  margin-top: 15px;
  border-collapse: collapse;
  overflow-x: auto;
  display: block;
}

.teacher-section table th, .teacher-section table td {
  border: 1px solid #ccc;
  padding: 8px;
  color: #fff;
  text-align: left;
  white-space: nowrap;
}

.teacher-section table th {
  background: rgba(255,255,255,0.25);
}

/* Responsive */
@media (max-width: 768px) {
  .teacher-section {
    padding: 15px;
    margin: 1rem;
  }
  .teacher-section table {
    font-size: 0.9rem;
  }
  .sidebar.active ~ .main { margin-left:0; }
}
</style>
</head>
<body>

<div class="topbar">
  <span class="menu-btn material-icons" id="menuBtn">more_vert</span>
  <h2>N-Sikhi Atracker</h2>
  <button class="logout-btn" id="logoutBtn">Logout</button>
</div>

<div class="sidebar" id="sidebar">
  <h3>Menu</h3>
  <ul>
    <li id="teacherManagerMenu"><span class="material-icons">people</span>Teacher Manager</li>
    <li><span class="material-icons">school</span>Student Manager</li>
    <li><span class="material-icons">class</span>Classes Manager</li>
    <li><span class="material-icons">menu_book</span>Subjects Manager</li>
    <li><span class="material-icons">assessment</span>Reports</li>
  </ul>
</div>

<div class="main" id="main">
  <div class="cards">
    <div class="card"><span class="material-icons">people</span><h3>Teacher Manager</h3></div>
    <div class="card"><span class="material-icons">school</span><h3>Student Manager</h3></div>
    <div class="card"><span class="material-icons">class</span><h3>Classes Manager</h3></div>
    <div class="card"><span class="material-icons">menu_book</span><h3>Subjects Manager</h3></div>
    <div class="card"><span class="material-icons">assessment</span><h3>Reports</h3></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const sidebar = document.getElementById('sidebar');
const menuBtn = document.getElementById('menuBtn');
const logoutBtn = document.getElementById('logoutBtn');
const teacherManagerMenu = document.getElementById('teacherManagerMenu');
const main = document.getElementById('main');

// Toggle sidebar
menuBtn.addEventListener('click', () => {
  sidebar.classList.toggle('active');
});

// Logout
logoutBtn.addEventListener('click', () => {
  localStorage.removeItem('isLoggedIn');
  localStorage.removeItem('userType');
  window.location.href = 'index.html';
});

// Session check
const userType = localStorage.getItem('userType');
const isLoggedIn = localStorage.getItem('isLoggedIn');
if(isLoggedIn !== "true" || userType !== "admin"){
  window.location.href = "index.html";
}

// Animate cards
const cards = document.querySelectorAll('.card');
window.addEventListener('load', () => {
  cards.forEach((card, index) => {
    setTimeout(() => card.classList.add('visible'), index * 150);
  });
});

// Supabase initialization
const supabaseUrl = 'https://zsdvjfmzeiejiyhwvkre.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpzZHZqZm16ZWllaml5aHd2a3JlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg3Njk2MzEsImV4cCI6MjA3NDM0NTYzMX0.d1LfZ9ZokL-GBkhvjNkTh97lueDE5hnHhbHeAm7Awz4';
const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

// Teacher Manager Section
function loadTeacherManager() {
  main.innerHTML = `
    <style>
      .teacher-section {
        max-width: 100%;
        padding: 16px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        font-family: Arial, sans-serif;
      }
      .teacher-section input, 
      .teacher-section button {
        margin: 6px 4px;
        padding: 8px;
      }
      .table-container {
        max-height: 300px; /* adjust height as needed */
        overflow-y: auto;
        margin-top: 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
      }
      #teacherTable {
        width: 100%;
        border-collapse: collapse;
      }
      #teacherTable th, #teacherTable td {
        padding: 8px;
        border: 1px solid #ddd;
        text-align: left;
      }
      #teacherTable th {
        background: #f2f2f2;
        position: sticky;
        top: 0;
      }
    </style>

    <div class="teacher-section">
      <h3>Teacher Management</h3>
      <input type="text" id="nameInput" placeholder="Name">
      <input type="text" id="userIdInput" placeholder="User ID">
      <input type="password" id="passwordInput" placeholder="Password">
      <button id="addBtn">Add Teacher</button>
      <button id="fetchBtn">Fetch Teachers</button>

      <div class="table-container">
        <table id="teacherTable">
          <thead>
            <tr>
              <th>Name</th>
              <th>User ID</th>
              <th>Password</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  `;
}
  `;

  const tbody = document.querySelector('#teacherTable tbody');

  async function fetchTeachers() {
    try {
      const { data, error } = await supabaseClient.from('teacher').select('*').order('created_at', { ascending: false });
      if (error) throw error;

      tbody.innerHTML = '';
      data.forEach(t => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${t.name}</td>
          <td>${t.user_id}</td>
          <td>${t.password}</td>
          <td>
            <button onclick="editTeacher('${t.id}', '${t.name}', '${t.user_id}', '${t.password}')">Edit</button>
            <button onclick="deleteTeacher('${t.id}')">Delete</button></td>
        `;
        tbody.appendChild(row);
      });
    } catch (err) {
      alert('Error fetching teachers: ' + err.message);
      console.error(err);
    }
  }

  document.getElementById('fetchBtn').addEventListener('click', fetchTeachers);

  document.getElementById('addBtn').addEventListener('click', async () => {
    const name = document.getElementById('nameInput').value.trim();
    const user_id = document.getElementById('userIdInput').value.trim();
    const password = document.getElementById('passwordInput').value.trim();
    if (!name || !user_id || !password) return alert('Please fill all fields');

    try {
      const { error } = await supabaseClient.from('teacher').insert([{ name, user_id, password }]);
      if (error) throw error;
      alert('Teacher added!');
      document.getElementById('nameInput').value = '';
      document.getElementById('userIdInput').value = '';
      document.getElementById('passwordInput').value = '';
      fetchTeachers();
    } catch (err) {
      alert('Error adding teacher: ' + err.message);
    }
  });

  window.deleteTeacher = async function(id) {
    if (!confirm('Are you sure you want to delete this teacher?')) return;
    try {
      const { error } = await supabaseClient.from('teacher').delete().eq('id', id);
      if (error) throw error;
      alert('Teacher deleted!');
      fetchTeachers();
    } catch (err) {
      alert('Error deleting teacher: ' + err.message);
    }
  }

  window.editTeacher = function(id, oldName, oldUserId, oldPassword) {
    const newName = prompt('Enter new name:', oldName);
    if (newName === null) return;
    const newUserId = prompt('Enter new User ID:', oldUserId);
    if (newUserId === null) return;
    const newPassword = prompt('Enter new Password:', oldPassword);
    if (newPassword === null) return;

    updateTeacher(id, newName, newUserId, newPassword);
  }

  async function updateTeacher(id, name, user_id, password) {
    try {
      const { error } = await supabaseClient.from('teacher').update({ name, user_id, password }).eq('id', id);
      if (error) throw error;
      alert('Teacher updated!');
      fetchTeachers();
    } catch (err) {
      alert('Error updating teacher: ' + err.message);
    }
  }

  fetchTeachers();
}

// Load teacher manager when sidebar menu clicked
teacherManagerMenu.addEventListener('click', loadTeacherManager);
</script>

</body>
</html>
